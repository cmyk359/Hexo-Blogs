<!DOCTYPE html>
<html>
  <head>
    <style>
      /* iframe 容器样式 */
      #matechat-iframe-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
      }

      #matechat-iframe-container.active {
        opacity: 1;
        visibility: visible;
      }

      .matechat-iframe {
        width: 100%;
        height: 100%;
        border: none;
        background: white;
      }

      #matechat-iframe-container.active .matechat-close-btn {
        opacity: 1;
      }

      /* 确保博客内容不会被覆盖 */
      body.matechat-open {
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <!-- MateChat iframe 容器 -->
    <div id="matechat-iframe-container">
      <!-- <div class="matechat-loading">
        <div class="loading-dots">
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
        </div>
      </div> -->
      <iframe
        class="matechat-iframe"
        src="https://chat.catpaws.top"
        allow="microphone"
        title="芙芙来帮你"
      >
      </iframe>
    </div>
    <script>
      // 等待 DOM 完全加载后再执行
      document.addEventListener("DOMContentLoaded", function () {
        // 获取元素
        const oml2dStage = document.getElementById("oml2d-stage");
        const matechatContainer = document.getElementById(
          "matechat-iframe-container"
        );

        // 检查元素是否存在
        if (!oml2dStage) {
          console.error("oml2d-stage 元素未找到");
          return;
        }

        if (!matechatContainer) {
          console.error("matechat-iframe-container 元素未找到");
          return;
        }

        // 打开 MateChat
        function openMateChat() {
          matechatContainer.classList.add("active");
          document.body.classList.add("matechat-open");
        }

        // 关闭 MateChat
        function closeMateChat() {
          matechatContainer.classList.remove("active");
          document.body.classList.remove("matechat-open");
        }

        // 绑定点击事件
        oml2dStage.addEventListener("click", openMateChat);

        // ESC 键关闭
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape") {
            closeMateChat();
          }
        });

        // 监听 iframe 发送的关闭消息
        window.addEventListener("message", function (event) {
          if (event.data === "closeMateChat" || event.data.type === "close") {
            closeMateChat();
          }
        });

        // 点击 iframe 容器外部关闭
        matechatContainer.addEventListener("click", function (e) {
          if (e.target === this) {
            closeMateChat();
          }
        });
      });
    </script>
  </body>
</html>
